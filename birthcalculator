<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìœ¡ì•„íœ´ì§ ê³„ì‚°ê¸°</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 480px;
      margin: auto;
    }
    .question {
      margin-bottom: 20px;
    }
    .question label::before {
      content: "â— ";
      font-size: 20px;
      color: #555;
      margin-right: 4px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      box-sizing: border-box;
      padding: 10px;
      margin-bottom: 10px;
      font-size: 16px;
    }
    select {
      appearance: none;
      background: url('data:image/svg+xml;charset=UTF-8,<svg fill="gray" height="16" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 10px center;
      background-color: white;
      background-size: 16px 16px;
      padding-right: 36px;
    }
    .hidden {
      display: none;
    }
    .result {
      background: #eef5ff;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #c3d7f2;
    }
    .result strong {
      font-size: 18px;
      color: #2a4f9c;
    }
  </style>
</head>
<body>
  <h2>ğŸ“… ìœ¡ì•„íœ´ì§ ê³„ì‚°ê¸°</h2>

  <div class="question" id="q1">
    <label>ì¶œì‚° ì˜ˆì •ì¼ì€ ì–¸ì œì¸ê°€ìš”?</label>
    <input type="date" id="dueDate" />
  </div>

  <div class="question hidden" id="q2">
    <label>ë‹¤íƒœì•„ì¸ê°€ìš”?</label>
    <select id="isMultiple">
      <option value="">ì„ íƒí•˜ì„¸ìš”</option>
      <option value="y">ì˜ˆ</option>
      <option value="n">ì•„ë‹ˆì˜¤</option>
    </select>
  </div>

  <div class="question hidden" id="q3">
    <label>ì›í•˜ëŠ” íœ´ì§ ì‹œì‘ì¼ì´ ìˆë‚˜ìš”?</label>
    <select id="hasCustomStart">
      <option value="">ì„ íƒí•˜ì„¸ìš”</option>
      <option value="yes">ì˜ˆ</option>
      <option value="no">ì•„ë‹ˆì˜¤</option>
    </select>
  </div>

  <div class="question hidden" id="q4">
    <label>ì›í•˜ëŠ” íœ´ì§ ì‹œì‘ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</label>
    <input type="date" id="customStart" />
  </div>

  <div class="question hidden" id="q5">
    <label>ì¶œì‚°ì¼ ë©°ì¹  ì „ì— ì‰¬ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?</label>
    <input type="number" id="earlyDays" placeholder="ì˜ˆ: 14" />
  </div>

  <div class="question hidden" id="q6">
    <label>ì”ì—¬ ì—°ì°¨ëŠ” ë©°ì¹ ì¸ê°€ìš”?</label>
    <input type="number" id="leaveDays" placeholder="ì˜ˆ: 9" />
  </div>

  <div class="question hidden" id="q7">
    <label>ì›í•˜ëŠ” ìœ¡ì•„íœ´ì§ ê°œì›” ìˆ˜ëŠ” ëª‡ ê°œì›”ì¸ê°€ìš”?</label>
    <input type="number" id="parentalMonths" placeholder="ì˜ˆ: 12" />
  </div>

  <div class="result hidden" id="result"></div>

  <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; font-size: 16px; width: 100%;">ì´ˆê¸°í™”</button>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const $ = (id) => document.getElementById(id);

      $("dueDate").addEventListener("change", () => validateAndShow(1, "dueDate"));
      $("isMultiple").addEventListener("change", () => validateAndShow(2, "isMultiple"));
      $("hasCustomStart").addEventListener("change", () => {
        const choice = $("hasCustomStart").value;
        $("q4").classList.toggle("hidden", choice !== "yes");
        $("q5").classList.toggle("hidden", choice !== "no");
        validateAndShow(3, "hasCustomStart");
      });
      $("customStart").addEventListener("change", () => validateAndShow(4, "customStart"));
      $("earlyDays").addEventListener("input", () => validateAndShow(5, "earlyDays"));
      $("leaveDays").addEventListener("input", () => validateAndShow(6, "leaveDays"));
      $("parentalMonths").addEventListener("input", calculate);

      function validateAndShow(current, inputId) {
        const value = $(inputId).value;
        const next = $("q" + (current + 1));

        // q3 ì´í›„ ë¡œì§ì€ handleStartChoiceê°€ ì œì–´í•¨
        if (inputId === "hasCustomStart") return;

        if (value && next) next.classList.remove("hidden");
        updateResultIfNeeded();
      }

      function formatDate(d) {
        return d.toISOString().split("T")[0];
      }

      function isWeekendOrHoliday(date) {
        const holidays = ["2025-01-01", "2025-03-01", "2025-05-05", "2025-06-06", "2025-08-15",
          "2025-09-14", "2025-09-15", "2025-09-16", "2025-10-03", "2025-10-09", "2025-12-25", "2025-05-06"];
        const day = date.getDay();
        const dateStr = formatDate(date);
        return day === 0 || day === 6 || holidays.includes(dateStr);
      }

      function countWeekdays(start, end) {
        let days = 0;
        for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
          if (!isWeekendOrHoliday(new Date(d))) days++;
        }
        return days;
      }

      function updateResultIfNeeded() {
        if ($("dueDate").value && $("isMultiple").value && $("leaveDays").value && $("parentalMonths").value) {
          calculate();
        }
      }

      function calculate() {
        const dueDate = new Date($("dueDate").value);
        const isMultiple = $("isMultiple").value === "y";
        const earlyDays = parseInt($("earlyDays").value || "0");
        const leaveDays = parseInt($("leaveDays").value);
        const parentalMonths = parseInt($("parentalMonths").value);
        const customStartStr = $("customStart").value;

        let leaveStart, leaveEnd;

        if (customStartStr) {
          leaveStart = new Date(customStartStr);
          leaveEnd = new Date(leaveStart);
          let count = 0;
          while (count < leaveDays) {
            if (!isWeekendOrHoliday(leaveEnd)) count++;
            if (count < leaveDays) leaveEnd.setDate(leaveEnd.getDate() + 1);
          }
        } else {
          leaveEnd = new Date(dueDate);
          leaveEnd.setDate(leaveEnd.getDate() - earlyDays - 1);
          leaveStart = new Date(leaveEnd);
          let count = 0;
          while (count < leaveDays) {
            if (!isWeekendOrHoliday(leaveStart)) count++;
            if (count < leaveDays) leaveStart.setDate(leaveStart.getDate() - 1);
          }
        }

        const weekdays = countWeekdays(leaveStart, leaveEnd);
        const maternityDays = isMultiple ? 120 : 90;
        const maternityStart = new Date(leaveEnd); maternityStart.setDate(maternityStart.getDate() + 1);
        const maternityEnd = new Date(maternityStart); maternityEnd.setDate(maternityEnd.getDate() + maternityDays - 1);
        const parentingStart = new Date(maternityEnd); parentingStart.setDate(parentingStart.getDate() + 1);
        const parentingEnd = new Date(parentingStart);
        parentingEnd.setMonth(parentingEnd.getMonth() + parentalMonths);
        parentingEnd.setDate(parentingEnd.getDate() - 1);

        const babyBorn = new Date(dueDate);
        const withBabyStart = new Date(babyBorn);
        withBabyStart.setDate(withBabyStart.getDate() + 1);
        const withBabyDays = Math.round((parentingEnd - withBabyStart) / 86400000) + 1;
        const totalRestDays = Math.round((parentingEnd - leaveStart) / 86400000) + 1;
        const parentingDays = Math.round((parentingEnd - parentingStart) / 86400000) + 1;
        const actualMonths = (parentingEnd.getFullYear() - parentingStart.getFullYear()) * 12 +
          (parentingEnd.getMonth() - parentingStart.getMonth()) +
          (parentingEnd.getDate() >= parentingStart.getDate() ? 1 : 0);

        $("result").classList.remove("hidden");
        $("result").innerHTML = `
          <strong>âœ”ï¸ ê²°ê³¼ ì•ˆë‚´</strong><br/><br/>
          <b>ì—°ì°¨:</b> ${formatDate(leaveStart)} ~ ${formatDate(leaveEnd)}<br/>
          - ì£¼ë§/ê³µíœ´ì¼ ì œì™¸ëœ ì‹¤ì—°ì°¨: ${weekdays}ì¼<br/><br/>
          <b>ì¶œì‚°íœ´ê°€:</b> ${formatDate(maternityStart)} ~ ${formatDate(maternityEnd)}<br/>
          - ì´ ${maternityDays}ì¼ (ì£¼ë§/ê³µíœ´ì¼ í¬í•¨)<br/><br/>
          <b>ìœ¡ì•„íœ´ì§:</b> ${formatDate(parentingStart)} ~ ${formatDate(parentingEnd)}<br/>
          - ì´ ${actualMonths}ê°œì›” (${parentingDays}ì¼, ì£¼ë§/ê³µíœ´ì¼ í¬í•¨)<br/><br/>
          <b>ì—„ë§ˆê°€ ì‰¬ëŠ” ì „ì²´ ê¸°ê°„:</b><br/> ${formatDate(leaveStart)} ~ ${formatDate(parentingEnd)} (${totalRestDays}ì¼)<br/>
          <b>ì•„ê¸°ì™€ í•¨ê»˜ ë³´ë‚´ëŠ” ê¸°ê°„:</b><br/> ${formatDate(withBabyStart)} ~ ${formatDate(parentingEnd)} (${withBabyDays}ì¼)
        `;
      }
    });
  </script>
</body>
</html>